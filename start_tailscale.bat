@echo off
REM –ó–∞–ø—É—Å–∫ Neira —Å –¥–æ—Å—Ç—É–ø–æ–º —á–µ—Ä–µ–∑ Tailscale (VPN-—Å–µ—Ç—å)
REM –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ —á–µ–º ngrok - –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å —Ç–≤–æ–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

echo ============================================================
echo   NEIRA via Tailscale (Private Network)
echo ============================================================
echo.

REM –í–∫–ª—é—á–∞–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —Å –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–º –ø—Ä–æ—Ñ–∏–ª–µ–º
set NEIRA_AUTH_ENABLED=true

echo ============================================================
echo   –ó–ê–©–ò–¢–ê –ê–ö–¢–ò–í–ò–†–û–í–ê–ù–ê
echo ============================================================
echo.
echo   –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∏—Å–ø–æ–ª—å–∑—É–π:
echo   –õ–æ–≥–∏–Ω: 0
echo   –ü–∞—Ä–æ–ª—å: 11111111 (–ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∏—Ç–∞)
echo ============================================================
echo.

REM –ü—Ä–æ–≤–µ—Ä—è–µ–º Tailscale
where tailscale >nul 2>&1
if errorlevel 1 (
    echo ‚ùå Tailscale –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!
    echo.
    echo –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
    echo   1. –°–∫–∞—á–∞–π: https://tailscale.com/download
    echo   2. –£—Å—Ç–∞–Ω–æ–≤–∏ –∏ –∑–∞–ª–æ–≥–∏–Ω—å—Å—è
    echo   3. –ù–∞ –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —Ç–æ–∂–µ —É—Å—Ç–∞–Ω–æ–≤–∏ Tailscale
    echo.
    echo –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–ø—É—Å—Ç–∏ —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞.
    pause
    exit /b 1
)

REM –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å Tailscale
echo [1/3] –ü—Ä–æ–≤–µ—Ä–∫–∞ Tailscale...
tailscale status >nul 2>&1
if errorlevel 1 (
    echo ‚ö†Ô∏è  Tailscale –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω. –ü–æ–¥–∫–ª—é—á–∞—é...
    tailscale up
    timeout /t 3 >nul
)

REM –ü–æ–ª—É—á–∞–µ–º Tailscale IP
for /f "tokens=1" %%i in ('tailscale ip -4') do set TAILSCALE_IP=%%i
echo ‚úÖ Tailscale IP: %TAILSCALE_IP%

REM –ü—Ä–æ–≤–µ—Ä—è–µ–º Ollama
echo [2/3] –ü—Ä–æ–≤–µ—Ä–∫–∞ Ollama...
curl -s http://localhost:11434/api/tags >nul 2>&1
if errorlevel 1 (
    start "" ollama serve
    timeout /t 3 >nul
)
echo ‚úÖ Ollama –≥–æ—Ç–æ–≤–∞

REM –ó–∞–ø—É—Å–∫–∞–µ–º backend (—Å–ª—É—à–∞–µ–º –Ω–∞ –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö)
echo [3/3] –ó–∞–ø—É—Å–∫ Backend...
cd backend

REM –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –∑–∞–ø—É—Å–∫ —á—Ç–æ–±—ã —Å–ª—É—à–∞—Ç—å –Ω–∞ 0.0.0.0
start "Neira Backend" cmd /k "python -c \"import uvicorn; uvicorn.run('api:app', host='0.0.0.0', port=8000, reload=False)\""
cd ..
timeout /t 4 >nul

echo.
echo ============================================================
echo   ‚úÖ NEIRA –î–û–°–¢–£–ü–ù–ê –ß–ï–†–ï–ó TAILSCALE!
echo ============================================================
echo.
echo   üè† –õ–æ–∫–∞–ª—å–Ω–æ:    http://localhost:8000
echo   üîí Tailscale:   http://%TAILSCALE_IP%:8000
echo.
echo   üì± –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è:
echo      1. –£—Å—Ç–∞–Ω–æ–≤–∏ Tailscale –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω/–¥—Ä—É–≥–æ–π –ü–ö
echo      2. –ó–∞–ª–æ–≥–∏–Ω—å—Å—è –≤ —Ç–æ—Ç –∂–µ –∞–∫–∫–∞—É–Ω—Ç
echo      3. –û—Ç–∫—Ä–æ–π http://%TAILSCALE_IP%:8000
echo.
echo   ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Tailscale:
echo      - –ù–µ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ URL (—Ç–æ–ª—å–∫–æ —Ç–≤–æ–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
echo      - –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ end-to-end
echo      - –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ª—é–±–æ–π NAT
echo      - –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 100 —É—Å—Ç—Ä–æ–π—Å—Ç–≤
echo ============================================================
echo.
pause
