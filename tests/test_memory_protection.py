#!/usr/bin/env python3
"""
–¢–µ—Å—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è –≤ memory_system
"""
from memory_system import MemorySystem, MemoryCategory
import time

def test_duplicate_protection():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤"""
    
    print("=" * 80)
    print("–¢–ï–°–¢ 1: –ó–ê–©–ò–¢–ê –û–¢ –¢–û–ß–ù–´–• –î–£–ë–õ–ò–ö–ê–¢–û–í")
    print("=" * 80)
    
    ms = MemorySystem()
    
    # –ü—ã—Ç–∞–µ–º—Å—è –¥–æ–±–∞–≤–∏—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–µ–∫—Å—Ç 3 —Ä–∞–∑–∞
    test_text = "–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è –∑–∞–ø–∏—Å—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤"
    
    print("\n1. –ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ (–¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–π—Ç–∏):")
    result1 = ms.remember(test_text, category=MemoryCategory.FACT, source="test")
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ' if result1 else '‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ'}")
    
    print("\n2. –í—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å —Ç–µ–º –∂–µ —Ç–µ–∫—Å—Ç–æ–º (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞):")
    result2 = ms.remember(test_text, category=MemoryCategory.FACT, source="test")
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ' if result2 else '‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ'}")
    print(f"   –í–µ—Ä–Ω—É–ª–∞—Å—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∑–∞–ø–∏—Å—å: {result2 == result1}")
    
    print("\n3. –¢—Ä–µ—Ç—å—è –ø–æ–ø—ã—Ç–∫–∞ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞):")
    result3 = ms.remember(test_text, category=MemoryCategory.FACT, source="test")
    print(f"   –†–µ–∑—É–ª—å—Ç–∞—Ç: {'‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ' if result3 else '‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ'}")


def test_loop_protection():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è"""
    
    print("\n" + "=" * 80)
    print("–¢–ï–°–¢ 2: –ó–ê–©–ò–¢–ê –û–¢ –ó–ê–¶–ò–ö–õ–ò–í–ê–ù–ò–Ø")
    print("=" * 80)
    
    ms = MemorySystem()
    
    # –ü—ã—Ç–∞–µ–º—Å—è –¥–æ–±–∞–≤–∏—Ç—å –º–Ω–æ–≥–æ –ø–æ—Ö–æ–∂–∏—Ö –∑–∞–ø–∏—Å–µ–π –∑–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è
    base_text = "–ö–ª–∞—Å—Å Analyzer —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ C++ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–æ–¥ analyze()"
    
    print("\n–ü–æ–ø—ã—Ç–∫–∞ –¥–æ–±–∞–≤–∏—Ç—å 10 –ø–æ—Ö–æ–∂–∏—Ö –∑–∞–ø–∏—Å–µ–π –∑–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è...")
    
    accepted = 0
    rejected = 0
    
    for i in range(10):
        # –ù–µ–º–Ω–æ–≥–æ –º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ç–æ—á–Ω—ã—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
        text = f"{base_text} –≤–µ—Ä—Å–∏—è {i}"
        result = ms.remember(text, category=MemoryCategory.LEARNED, source="test")
        
        if result:
            accepted += 1
            print(f"  {i+1}. ‚úÖ –ü—Ä–∏–Ω—è—Ç–æ")
        else:
            rejected += 1
            print(f"  {i+1}. ‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ (–∑–∞—â–∏—Ç–∞ –æ—Ç –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è)")
        
        time.sleep(0.1)  # –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
    
    print(f"\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç:")
    print(f"   –ü—Ä–∏–Ω—è—Ç–æ: {accepted}")
    print(f"   –û—Ç–∫–ª–æ–Ω–µ–Ω–æ: {rejected}")
    print(f"   {'‚úÖ –ó–ê–©–ò–¢–ê –†–ê–ë–û–¢–ê–ï–¢' if rejected > 0 else '‚ö†Ô∏è –í—Å–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏–Ω—è—Ç—ã'}")


def test_similarity_calculation():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ä–∞—Å—á–µ—Ç —Å—Ö–æ–∂–µ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–æ–≤"""
    
    print("\n" + "=" * 80)
    print("–¢–ï–°–¢ 3: –†–ê–°–ß–ï–¢ –°–•–û–ñ–ï–°–¢–ò –¢–ï–ö–°–¢–û–í")
    print("=" * 80)
    
    ms = MemorySystem()
    
    text1 = "–ö–ª–∞—Å—Å Analyzer —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ —è–∑—ã–∫–µ C++"
    text2 = "–ö–ª–∞—Å—Å Analyzer —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ —è–∑—ã–∫–µ Python"
    text3 = "–ü–æ–≥–æ–¥–∞ —Å–µ–≥–æ–¥–Ω—è —Ö–æ—Ä–æ—à–∞—è –∏ —Å–æ–ª–Ω–µ—á–Ω–∞—è"
    
    sim1 = ms._calculate_text_similarity(text1, text2)
    sim2 = ms._calculate_text_similarity(text1, text3)
    
    print(f"\n–¢–µ–∫—Å—Ç 1: {text1}")
    print(f"–¢–µ–∫—Å—Ç 2: {text2}")
    print(f"–°—Ö–æ–∂–µ—Å—Ç—å: {sim1:.2f} (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã—Å–æ–∫–æ–π ~0.8-0.9)")
    
    print(f"\n–¢–µ–∫—Å—Ç 1: {text1}")
    print(f"–¢–µ–∫—Å—Ç 3: {text3}")
    print(f"–°—Ö–æ–∂–µ—Å—Ç—å: {sim2:.2f} (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∏–∑–∫–æ–π ~0.0-0.1)")


if __name__ == "__main__":
    print("üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–©–ò–¢–´ –û–¢ –ó–ê–¶–ò–ö–õ–ò–í–ê–ù–ò–Ø\n")
    
    test_duplicate_protection()
    test_loop_protection()
    test_similarity_calculation()
    
    print("\n" + "=" * 80)
    print("‚úÖ –í–°–ï –¢–ï–°–¢–´ –ó–ê–í–ï–†–®–ï–ù–´")
    print("=" * 80)
