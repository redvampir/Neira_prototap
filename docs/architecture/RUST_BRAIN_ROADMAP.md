# Rust Brain Roadmap — офлайн‑ядро и автономность

## 1. Цель дорожной карты

Собрать офлайн‑ядро Rust Brain, которое обеспечивает автономность ≥ 70% запросов без LLM‑fallback, оставаясь работоспособным при отсутствии сети и с соблюдением p95‑латентности локального контура. Приоритет — критический путь «intent → router → pathways → memory → synth» без внешних сервисов.

---

## 2. Этапы 0–3

### Этап 0 — подготовка форматов/глоссария/контрактов

**Входы:**
- Текущие архитектурные документы и терминология.
- Критерии автономии/латентности/деградации из Rust Brain V1.

**Выходы:**
- Единый глоссарий терминов.
- Форматы данных и версии схем.
- Контракты интерфейсов для ядра и адаптеров.

**Критерии готовности:**
- Термины и сущности согласованы и зафиксированы.
- Схемы данных версионируемы и описаны.
- Контракты определяют входы/выходы/ошибки и правила деградации.

---

### Этап 1 — офлайн‑ядро (intent/router/pathways/memory/synth)

**Входы:**
- Глоссарий, форматы данных и контракты из Этапа 0.
- Требования по автономности, латентности и деградации.

**Выходы:**
- Полностью локальный контур обработки: intent → router → pathways → memory → synth.
- Логирование причин деградации и меток `degraded`.
- Локальный CLI/утилиты для тестов автономности.

**Критерии готовности:**
- Критический путь работает без сети и внешних сервисов.
- p95‑латентность локальных слоёв соблюдена.
- Доля автономии ≥ 70% в тестовой выборке.

---

### Этап 2 — learning/wisdom + метрики автономности

**Входы:**
- Офлайн‑ядро из Этапа 1.
- Данные для локального обучения/обобщения.

**Выходы:**
- Механизмы learning/wisdom, работающие в офлайн‑контуре.
- Измеримые метрики автономности (offline_success/total_requests).
- Отчёты по латентности и деградации.

**Критерии готовности:**
- Метрики автономности собираются автоматически.
- Данные о деградациях содержат причину и контекст.
- Автономность не ниже целевого порога при включённом learning/wisdom.

---

### Этап 3 — адаптеры (LLM fallback/интеграции)

**Входы:**
- Стабильное офлайн‑ядро с метриками.
- Контракты адаптеров и правила деградации.

**Выходы:**
- Адаптеры LLM fallback и интеграций.
- Изоляция сетевых рисков от офлайн‑ядра.

**Критерии готовности:**
- LLM вызывается только после двух локальных стратегий.
- При превышении локального p95‑бюджета LLM блокируется.
- Отказ адаптеров не нарушает автономный режим.

---

## 3. Риски и способы снижения

- **Latency‑провалы:** соблюдение p95‑бюджета (≤ 180 мс локально).  
  *Снижение:* профилирование, лимиты на операции памяти, деградация с меткой `degraded`.
- **Потеря паттернов при офлайн‑обработке:** ухудшение качества без LLM.  
  *Снижение:* локальные шаблоны, learning/wisdom с регулярной консолидацией.
- **Зависимость от сети:** блокировки из‑за внешних сервисов.  
  *Снижение:* строгий офлайн‑контур, сетевые адаптеры только как fallback.

---

## 4. Привязка к метрикам из RUST_BRAIN_V1

- **Автономность ≥ 70%** — цель этапов 1–2, обязательный критерий для выхода на этап 3.
- **p95‑латентность по слоям** — критерий готовности этапа 1 и барьер для LLM‑fallback на этапе 3.
- **Правила деградации** — фиксируются на этапах 1–2, используются для изоляции сетевых рисков.
- **Минимальные тестовые сценарии** — проверка готовности этапов 1–2 и калибровка качества.

См. базовые метрики и правила в документе: [RUST_BRAIN_V1.md](RUST_BRAIN_V1.md).
