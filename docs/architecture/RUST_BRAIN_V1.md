# Rust Brain V1 — каркас спецификации

> Цель документа: зафиксировать первую версию архитектурных ожиданий для Rust‑ядра мозга Neira.

## Область ответственности

- Детерминированные форматы данных и стабильные инварианты.
- Понятные границы между памятью, путями и «мудростью».
- Стандартизированная сериализация для обмена и миграций.

## Принципы

- Глоссарий терминов архитектуры: [RUST_BRAIN_GLOSSARY.md](RUST_BRAIN_GLOSSARY.md).

## Критерии автономии и приемки

- **Метрика автономии:** ≥ 70% запросов должны обрабатываться без LLM (по счетчику `offline_success / total_requests`).
- **Допустимая латентность по слоям (p95):**
  - Входная нормализация: ≤ 20 мс.
  - Маршрутизация клетки/органа: ≤ 30 мс.
  - Память (чтение): ≤ 50 мс, запись: ≤ 80 мс.
  - Планирование/реакции: ≤ 60 мс.
  - Суммарный локальный бюджет без LLM: ≤ 180 мс.
- **Правила fallback:**
  - LLM вызывается только после двух неудачных локальных стратегий.
  - При деградации (ошибка памяти/маршрута) переход в упрощенный режим без LLM и запись причины в лог.
  - Если суммарная латентность превышает 180 мс, блок LLM запрещен и возвращается локальный ответ с меткой `degraded`.
- **Минимальные тестовые сценарии:**
  - *Ручные:* 3 типовых диалога (FAQ, команда, ошибка ввода) без LLM; 1 сценарий деградации (отключение памяти).
  - *Автоматизированные:* smoke для загрузки конфигурации; p95-латентность по слоям; проверка доли автономии ≥ 70% на 100 запросах.

## Следующие артефакты

- [RUST_BRAIN_DATA_FORMATS.md](RUST_BRAIN_DATA_FORMATS.md) — схемы данных, сериализация и правила версионирования.
- [RUST_BRAIN_CRATES.md](RUST_BRAIN_CRATES.md) — состав модулей, границы ответственности и минимальные интерфейсы.
