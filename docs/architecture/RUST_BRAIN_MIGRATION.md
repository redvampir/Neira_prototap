# Миграция мозга Neira в Rust

> Цель документа: зафиксировать состав данных, требования к новым форматам и последовательность миграции.

## 1) Какие данные переносятся

**Переносимые домены:**
- **Pathways** — граф маршрутов решений и связей между клетками/органами.
- **Memory** — долговременная, краткосрочная и эмоциональная память (структурированные записи, метаданные, ссылки).
- **Wisdom Core** — слой проверенных правил, выводов и устойчивых обобщений.
- **Feedback** — обратная связь пользователей/системы (эмодзи, оценки, причины).

## 2) «Новые» форматы и почему не требуется 1:1 совместимость

**Что считается «новым форматом»:**
- **Схемы хранения в Rust** (строгие типы, версии структур, сериализация с явными инвариантами).
- **Нормализованные словари/графы**, где поля разделены на обязательные и опциональные, а идентификаторы унифицированы.
- **Слои метаданных** (происхождение, версия, качество) вынесены в общие структуры.

**Почему не нужна 1:1 совместимость:**
- Rust‑ядро вводит **новые инварианты данных** (типобезопасность, контроль версий, строгие контракты).
- Миграция — это **повышение качества данных**, а не копирование старого формата.
- Часть старых полей является **техническим шумом** и не должна сохраняться без очистки.
- Приоритет — **целостность и устойчивость** новых потоков, а не сохранение исторических артефактов.

## 3) Порядок миграции по этапам

1. **Intent**
   - Зафиксировать целевые сценарии и минимальный набор функциональности.
   - Определить критические потоки (запрос → решение → память → обучение).

2. **Pathways / Memory**
   - Мигрировать графы путей и ключевые типы памяти.
   - Ввести версионирование схем и базовые правила консистентности.

3. **Wisdom**
   - Перенести ядро «проверенных правил» и нормализовать правила.
   - Включить валидацию против конфликтов и дублирования.

4. **Learning Loop**
   - Подключить Feedback и циклы обучения.
   - Проверить корректность обновления путей и памяти на основе обратной связи.

## 4) Минимальный чек‑лист валидации после миграции

- **Coverage ≥ 70%** для новых модулей, отвечающих за Pathways/Memory/Wisdom/Feedback.
- **Fallback LLM доступен** и протестирован (резервный провайдер/режим при деградации).
- **Деградация latency** допустима: рост задержек не превышает согласованный порог (фиксируется в метриках).
- **Валидация схем**: все структуры данных проходят проверку версий и инвариантов.
- **Согласованность данных**: отсутствуют дубликаты ключевых сущностей и противоречивые записи.

---

Если потребуется расширение форматов или новые требования к инвариантам — документ обновляется в первую очередь.
