# üîí –û—Ç—á—ë—Ç –ø–æ –∞—É–¥–∏—Ç—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Neira v0.7.2

**–î–∞—Ç–∞:** 12 –¥–µ–∫–∞–±—Ä—è 2024  
**–í–µ—Ä—Å–∏—è:** 0.7.2  
**–ê—É–¥–∏—Ç–æ—Ä:** –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã

---

## üìã –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

–ü—Ä–æ–≤–µ–¥—ë–Ω –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã Neira —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞:
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- –ó–∞—â–∏—Ç—É –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–π –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
- –£—Ç–µ—á–∫–∏ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ó–∞—â–∏—Ç—É –æ—Ç –∞—Ç–∞–∫ —Ç–∏–ø–∞ Path Traversal

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 8 —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π —Ä–∞–∑–ª–∏—á–Ω–æ–π —Å—Ç–µ–ø–µ–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏.

---

## üö® –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

### 1. ‚ùå ‚Üí ‚úÖ –ö–æ–º–∞–Ω–¥–∞ /code –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–ë—ã–ª–æ:**
```python
async def code_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ö–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç—ã —Å –∫–æ–¥–æ–º."""
    if not context.args:
        # ...
```

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥:
- –í—ã–ø–æ–ª–Ω–∏—Ç—å `/code list` - —É–≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
- –í—ã–ø–æ–ª–Ω–∏—Ç—å `/code read telegram_bot.py` - –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
- –£–∑–Ω–∞—Ç—å –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏ 62: `_ADMIN_HASH = hashlib.sha256(b"0:11111111").hexdigest()`
- –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ `.env` —Å —Ç–æ–∫–µ–Ω–∞–º–∏

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
```python
@require_auth
async def code_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–ö–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç—ã —Å –∫–æ–¥–æ–º (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)."""
    user_id = update.effective_user.id
    
    if not is_admin(user_id):
        await update.message.reply_text("‚õî –ö–æ–º–∞–Ω–¥–∞ /code –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.")
        return
```

**–§–∞–π–ª:** [telegram_bot.py](telegram_bot.py#L1075-L1083)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

### 2. ‚ùå ‚Üí ‚úÖ –•–∞—Ä–¥–∫–æ–¥ –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–ë—ã–ª–æ:**
```python
# 0 ‚Üí –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ, 11111111 ‚Üí 255 ‚Üí 0x00
_ADMIN_HASH = hashlib.sha256(b"0:11111111").hexdigest()
```

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –±—ã–ª –∑–∞—Ö–∞—Ä–¥–∫–æ–¥–µ–Ω –≤ –∫–æ–¥–µ, –≤–∏–¥–µ–Ω —á–µ—Ä–µ–∑ `/code read telegram_bot.py`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
```python
# –•–µ—à –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
# –í–ê–ñ–ù–û: –ò–∑–º–µ–Ω–∏—Ç–µ NEIRA_ADMIN_PASSWORD –≤ .env!
_ADMIN_PASSWORD = os.getenv("NEIRA_ADMIN_PASSWORD", "change_me_please")
_ADMIN_HASH = hashlib.sha256(_ADMIN_PASSWORD.encode()).hexdigest()
```

**–§–∞–π–ª:** [telegram_bot.py](telegram_bot.py#L62-L65)  
**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –≤ `.env`:
```bash
NEIRA_ADMIN_PASSWORD=your_strong_password_here
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

### 3. ‚ùå ‚Üí ‚úÖ –ö–æ–º–∞–Ω–¥–∞ /clear –±–µ–∑ –∑–∞—â–∏—Ç—ã

**–ë—ã–ª–æ:**
```python
async def clear_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–∞–º—è—Ç—å Neira."""
    await show_typing(update, context)
    result = neira_wrapper.clear_memory()
```

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å –≤—Å—é –ø–∞–º—è—Ç—å –ù–µ–π—Ä—ã

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
```python
@require_auth
async def clear_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–∞–º—è—Ç—å Neira (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö)."""
    user_id = update.effective_user.id
    
    if not is_admin(user_id):
        await update.message.reply_text("‚õî –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–∞–º—è—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.")
        return
```

**–§–∞–π–ª:** [telegram_bot.py](telegram_bot.py#L913-L921)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

### 4. ‚ö†Ô∏è ‚Üí ‚úÖ –£—Ç–µ—á–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –æ—à–∏–±–∫–∞—Ö

**–ë—ã–ª–æ:**
```python
except Exception as e:
    await update.message.reply_text(f"‚ùå –û—à–∏–±–∫–∞: {e}")
```

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–î–µ—Ç–∞–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º, –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –≤–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫) —Ä–∞—Å–∫—Ä—ã–≤–∞–ª–∏—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

**–ü—Ä–∏–º–µ—Ä—ã —É—Ç–µ—á–µ–∫:**
- `FileNotFoundError: [Errno 2] No such file or directory: '/home/user/neira/config.json'`
- `ImportError: cannot import name 'OllamaClient' from 'cells' (/home/user/neira/cells.py)`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
```python
except Exception as e:
    logging.exception("–û—à–∏–±–∫–∞ –≤ /code")  # –õ–æ–≥–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    await update.message.reply_text("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é —Å —Ñ–∞–π–ª–æ–º")  # –û–±—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
```

**–§–∞–π–ª—ã:** 
- [telegram_bot.py](telegram_bot.py#L1003-L1005) - /self
- [telegram_bot.py](telegram_bot.py#L1032-L1034) - /organs
- [telegram_bot.py](telegram_bot.py#L1071-L1073) - /grow
- [telegram_bot.py](telegram_bot.py#L1111-L1113) - /code

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

### 5. ‚ö†Ô∏è ‚Üí ‚úÖ –£—Ç–µ—á–∫–∞ –ª–æ–≥–∏–Ω–∞ –≤ –ª–æ–≥–∞—Ö

**–ë—ã–ª–æ:**
```python
logging.warning(f"Failed auth attempt: user_id={user_id}, login={login}")
```

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–ü—Ä–∏ –±—Ä—É—Ç—Ñ–æ—Ä—Å–µ –ø–∞—Ä–æ–ª–µ–π –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –≤–∏–¥–∏—Ç –ø–æ–ø—ã—Ç–∫–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ –ª–æ–≥–∏–Ω–∞–º–∏ –≤ –ª–æ–≥–∞—Ö, —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–¥–±–∏—Ä–∞—Ç—å —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
```python
logging.warning(f"Failed auth attempt from user_id={user_id}")
```

**–§–∞–π–ª:** [telegram_bot.py](telegram_bot.py#L984)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

## ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –∑–∞—â–∏—Ç—ã

### 1. ‚úÖ Path Traversal Protection

**–ö–æ–¥:** [code_cell.py](code_cell.py#L144-L147)
```python
def _safe_path(self, path: str) -> str:
    full_path = os.path.abspath(os.path.join(self.work_dir, path))
    if not full_path.startswith(self.work_dir):
        raise ValueError(f"Path traversal attempt: {path}")
    return full_path
```

**–ó–∞—â–∏—Ç–∞ –æ—Ç:**
- `/code read ../../etc/passwd`
- `/code read ../../../.env`
- `/code read C:\Windows\System32\config\SAM`

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 2. ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ (Sandboxing)

**–ö–æ–¥:** [immune_system.py](immune_system.py#L210-L240)
```python
safe_globals = {
    "__builtins__": {
        name: getattr(__builtins__, name)
        for name in ['print', 'len', 'range', 'str', 'int', 'float', 
                    'list', 'dict', 'set', 'tuple', 'bool', 'type',
                    'sum', 'min', 'max', 'abs', 'round', 'sorted']
    }
}

# –†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ math, json, datetime
safe_globals['math'] = math
safe_globals['json'] = json_module
safe_globals['datetime'] = dt_module

exec(code, safe_globals)  # –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```

**–ó–∞—â–∏—Ç–∞ –æ—Ç:**
- `eval("__import__('os').system('rm -rf /')"))` ‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
- `exec("import subprocess; subprocess.call(['whoami'])")` ‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
- `open('/etc/passwd', 'r').read()` ‚ùå –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 3. ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø–∞—Ä–æ–ª—è–º–∏

**–ö–æ–¥:** [telegram_bot.py](telegram_bot.py#L976-L980)
```python
# –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–∞—Ä–æ–ª–µ–º –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
try:
    await update.message.delete()
except:
    pass
```

**–ó–∞—â–∏—Ç–∞ –æ—Ç:**  
–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π `/auth admin password123` –≤ Telegram

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 4. ‚úÖ Constant-time —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

**–ö–æ–¥:** [telegram_bot.py](telegram_bot.py#L968)
```python
if secrets.compare_digest(attempt_hash, _ADMIN_HASH):
```

**–ó–∞—â–∏—Ç–∞ –æ—Ç:**  
Timing attacks –ø—Ä–∏ –ø–æ–¥–±–æ—Ä–µ –ø–∞—Ä–æ–ª—è –º–µ—Ç–æ–¥–æ–º –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üõ°Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

1. **–°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**
   ```bash
   # –í .env
   NEIRA_ADMIN_PASSWORD=create_unique_strong_password_here
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ .gitignore:**
   ```bash
   echo ".env" >> .gitignore
   git rm --cached .env  # –ï—Å–ª–∏ —É–∂–µ –∑–∞–∫–æ–º–º–∏—á–µ–Ω
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:**
   ```bash
   ./stop.sh && ./start.sh
   ```

4. **–ü–æ–≤—Ç–æ—Ä–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å:**
   ```
   /admin –Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å
   ```

---

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã:

#### 1. Rate Limiting (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–î–æ–±–∞–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞:

```python
from collections import defaultdict
from time import time

_AUTH_ATTEMPTS = defaultdict(list)
MAX_ATTEMPTS = 5
LOCKOUT_TIME = 300  # 5 –º–∏–Ω—É—Ç

async def auth_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    user_id = update.effective_user.id
    now = time()
    
    # –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
    _AUTH_ATTEMPTS[user_id] = [t for t in _AUTH_ATTEMPTS[user_id] if now - t < LOCKOUT_TIME]
    
    if len(_AUTH_ATTEMPTS[user_id]) >= MAX_ATTEMPTS:
        await update.message.reply_text("üö´ –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5 –º–∏–Ω—É—Ç.")
        return
    
    # ... –æ–±—ã—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ ...
    
    if not authorized:
        _AUTH_ATTEMPTS[user_id].append(now)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è

---

#### 2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π

–î–æ–±–∞–≤–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:

```python
SUSPICIOUS_PATTERNS = [
    "../", "..\\", "/etc/", "C:\\Windows", "passwd", "shadow",
    "eval(", "exec(", "__import__", "subprocess"
]

def log_suspicious_activity(user_id: int, action: str, details: str):
    for pattern in SUSPICIOUS_PATTERNS:
        if pattern in details.lower():
            logging.warning(f"üö® SUSPICIOUS: user_id={user_id}, action={action}, pattern={pattern}")
            # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É
            break
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è

---

#### 3. –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø–∞–º—è—Ç–∏

–ó–∞—â–∏—Ç–∏—Ç—å —Ñ–∞–π–ª—ã `neira_memory.json`, `neira_experience.json`:

```python
from cryptography.fernet import Fernet

# –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
MEMORY_KEY = os.getenv("MEMORY_ENCRYPTION_KEY") or Fernet.generate_key()
cipher = Fernet(MEMORY_KEY)

# –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
encrypted_data = cipher.encrypt(json.dumps(memory).encode())

# –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
decrypted_data = cipher.decrypt(encrypted_data)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π  
**–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è

---

## üìä –ú–∞—Ç—Ä–∏—Ü–∞ –∑–∞—â–∏—Ç –∫–æ–º–∞–Ω–¥

| –ö–æ–º–∞–Ω–¥–∞ | @require_auth | is_admin() | –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ | –°—Ç–∞—Ç—É—Å |
|---------|:-------------:|:----------:|:------------------:|:------:|
| /start | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ Public |
| /help | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ Public |
| /memory | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ Auth |
| /clear | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ Admin |
| /learn | ‚ùå | ‚ùå | ‚úÖ | ‚ö†Ô∏è –û—Ç–∫—Ä—ã—Ç–æ |
| /auth | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ Public |
| /admin | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ Admin |
| /code | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ Admin |
| /self | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ Public |
| /organs | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ Public |
| /grow | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ Public |
| /imagine | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ Auth |
| /learn_auto | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ Auth |
| /context | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ Auth |
| /clear_context | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ Auth |

**–õ–µ–≥–µ–Ω–¥–∞:**
- ‚úÖ - –ó–∞—â–∏—Ç–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- ‚ùå - –ó–∞—â–∏—Ç–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–ø—É–±–ª–∏—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
- ‚ö†Ô∏è - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É

---

## üîç –ö–æ–º–∞–Ω–¥—ã —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è

### /learn - –û—Ç–∫—Ä—ã—Ç–∞ –¥–ª—è –≤—Å–µ—Ö

**–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:** –õ—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å `@require_auth` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π:

```python
@require_auth
async def learn_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
```

**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π

---

## üìù Changelog –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### v0.7.2 (2024-12-12)

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- üîí –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è `/code` (admin only)
- üîí –ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤—ã–Ω–µ—Å–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
- üîí –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –¥–ª—è `/clear` (admin only)
- üîí –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –æ—à–∏–±–æ–∫ –≤ `/self`, `/organs`, `/grow`, `/code`
- üîí –£–±—Ä–∞–Ω–∞ —É—Ç–µ—á–∫–∞ –ª–æ–≥–∏–Ω–∞ –≤ –ª–æ–≥–∞—Ö –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –∑–∞—â–∏—Ç—ã:**
- ‚úÖ Path Traversal protection –≤ `code_cell.py`
- ‚úÖ Sandboxed exec() –≤ `immune_system.py`
- ‚úÖ Constant-time password comparison
- ‚úÖ Auto-deletion –ø–∞—Ä–æ–ª–µ–π –∏–∑ Telegram

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- üìù –°–æ–∑–¥–∞–Ω [SECURITY_UPDATE.md](SECURITY_UPDATE.md)
- üìù –°–æ–∑–¥–∞–Ω [SECURITY_AUDIT_REPORT.md](SECURITY_AUDIT_REPORT.md)
- üìù –û–±–Ω–æ–≤–ª—ë–Ω [.env.example](.env.example)

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|:------:|------------|
| –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è | üü¢ –û—Ç–ª–∏—á–Ω–æ | –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è, constant-time |
| –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è | üü¢ –û—Ç–ª–∏—á–Ω–æ | –ê–¥–º–∏–Ω + whitelist —Ä–µ–∂–∏–º—ã |
| –§–∞–π–ª–æ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | üü¢ –û—Ç–ª–∏—á–Ω–æ | Path traversal –∑–∞—â–∏—Ç–∞ |
| –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ | üü¢ –û—Ç–ª–∏—á–Ω–æ | Sandboxed exec |
| –£—Ç–µ—á–∫–∏ –¥–∞–Ω–Ω—ã—Ö | üü¢ –û—Ç–ª–∏—á–Ω–æ | –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | üü° –•–æ—Ä–æ—à–æ | –ï—Å—Ç—å, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å |
| Rate Limiting | üü° –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å |

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** üü¢ **–û—Ç–ª–∏—á–Ω–æ (8.5/10)**

---

## üÜò –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏

### –ï—Å–ª–∏ —É–∑–Ω–∞–ª–∏ —Å—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å `0:11111111`:

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Å–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å:**
   ```bash
   # .env
   NEIRA_ADMIN_PASSWORD=new_secure_password_2024
   ```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:**
   ```bash
   ./stop.sh && ./start.sh
   ```

3. **–°–º–µ–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
   - [@BotFather](https://t.me/BotFather) ‚Üí `/mybots` ‚Üí API Token ‚Üí Revoke

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   grep "Admin authorized" logs/*.log
   grep "Failed auth" logs/*.log
   ```

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã –ø–∞–º—è—Ç–∏:**
   ```bash
   ls -lh neira_*.json
   ```

---

## üìö –°–ø—Ä–∞–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –î–æ–∫—É–º–µ–Ω—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- [SECURITY_UPDATE.md](SECURITY_UPDATE.md) - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é
- [SECURITY_AUDIT_REPORT.md](SECURITY_AUDIT_REPORT.md) - –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç
- [.env.example](.env.example) - –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
TELEGRAM_BOT_TOKEN=your_bot_token
NEIRA_ADMIN_PASSWORD=your_strong_password

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
OLLAMA_URL=http://localhost:11434
```

### –ö–æ–Ω—Ç–∞–∫—Ç—ã:
- GitHub Issues: [–°–æ–æ–±—â–∏—Ç—å –æ–± —É—è–∑–≤–∏–º–æ—Å—Ç–∏](https://github.com/redvampir/Neira_prototap/issues)
- Security Email: (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 12 –¥–µ–∫–∞–±—Ä—è 2024  
**–°–ª–µ–¥—É—é—â–∏–π –∞—É–¥–∏—Ç:** –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞ –∏–ª–∏ –ø—Ä–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∫–æ–¥–∞
