#!/bin/bash

# Neira v0.6.1 - –°–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Ollama —Å–µ—Ä–≤–µ—Ä

# –¶–≤–µ—Ç–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

echo -e "${BLUE}"
echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë             NEIRA v0.6.1 ‚Äî –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã                ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo -e "${NC}"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω –ª–∏ Ollama
if curl -s http://localhost:11434/api/tags > /dev/null 2>&1; then
    echo -e "${YELLOW}üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é Ollama...${NC}"

    # –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å Ollama
    OLLAMA_PID=$(pgrep -f "ollama serve")

    if [ -n "$OLLAMA_PID" ]; then
        kill $OLLAMA_PID 2>/dev/null
        sleep 1

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è
        if ! curl -s http://localhost:11434/api/tags > /dev/null 2>&1; then
            echo -e "${GREEN}‚úÖ Ollama –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω${NC}"
        else
            echo -e "${YELLOW}‚ö†Ô∏è  –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞...${NC}"
            kill -9 $OLLAMA_PID 2>/dev/null
            echo -e "${GREEN}‚úÖ Ollama –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ)${NC}"
        fi
    else
        echo -e "${YELLOW}‚ö†Ô∏è  –ü—Ä–æ—Ü–µ—Å—Å Ollama –Ω–µ –Ω–∞–π–¥–µ–Ω, –Ω–æ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç${NC}"
        echo -e "${YELLOW}‚ö†Ô∏è  –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é: killall ollama${NC}"
    fi
else
    echo -e "${GREEN}‚úÖ Ollama –Ω–µ –∑–∞–ø—É—â–µ–Ω${NC}"
fi

echo ""
echo -e "${BLUE}üí° –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:${NC}"
echo -e "  - Neira –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Ctrl+C"
echo -e "  - –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ JSON —Ñ–∞–π–ª–∞—Ö"
echo -e "  - –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ${YELLOW}./start.sh${NC}"
echo ""
