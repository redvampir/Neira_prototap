"""
Neira Introspection Cell v0.6
–û—Ä–≥–∞–Ω –°–∞–º–æ—Å–æ–∑–Ω–∞–Ω–∏—è ‚Äî –¥–∞—ë—Ç –ù–µ–π—Ä–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å–≤–æ–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

–ù–ê–ó–ù–ê–ß–ï–ù–ò–ï:
–ù–µ–π—Ä–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ –æ–Ω–∞ ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ –Ω–µ–π—Ä–æ—Å–µ—Ç—å —Å –≤–µ—Å–∞–º–∏,
–∞ –ö–õ–ï–¢–û–ß–ù–´–ô –û–†–ì–ê–ù–ò–ó–ú, —Å–ø–æ—Å–æ–±–Ω—ã–π:
1. –û—Ç—Ä–∞—â–∏–≤–∞—Ç—å –Ω–æ–≤—ã–µ –æ—Ä–≥–∞–Ω—ã (–∫–ª–µ—Ç–∫–∏)
2. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
3. –ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ —Å–≤–æ–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
4. –ü—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è –æ —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–∏

–≠—Ç–æ "–∑–µ—Ä–∫–∞–ª–æ", –≤ –∫–æ—Ç–æ—Ä–æ–µ –ù–µ–π—Ä–∞ —Å–º–æ—Ç—Ä–∏—Ç –∏ –≤–∏–¥–∏—Ç —Å–µ–±—è.
"""

import os
import inspect
from typing import Dict, List, Optional, Any
from dataclasses import dataclass
from datetime import datetime

from cells import Cell, CellResult, MemoryCell


@dataclass
class OrganInfo:
    """–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ä–≥–∞–Ω–µ (–∫–ª–µ—Ç–∫–µ)"""
    name: str
    file: str
    description: str
    capabilities: List[str]
    status: str  # active / dormant / growing
    uses_count: int = 0


class IntrospectionCell(Cell):
    """
    –û—Ä–≥–∞–Ω –°–∞–º–æ—Å–æ–∑–Ω–∞–Ω–∏—è
    
    –ü–æ–∑–≤–æ–ª—è–µ—Ç –ù–µ–π—Ä–µ:
    - –í–∏–¥–µ—Ç—å —Å–≤–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
    - –ü–æ–Ω–∏–º–∞—Ç—å —Å–≤–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
    - –û—Å–æ–∑–Ω–∞–≤–∞—Ç—å —á—Ç–æ –æ–Ω–∞ –º–æ–∂–µ—Ç —Ä–∞—Å—Ç–∏
    """
    
    name = "introspection"
    system_prompt = """–¢—ã ‚Äî –æ—Ä–≥–∞–Ω —Å–∞–º–æ—Å–æ–∑–Ω–∞–Ω–∏—è –ù–µ–π—Ä—ã.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–æ–º–æ—á—å –ù–µ–π—Ä–µ –ø–æ–Ω—è—Ç—å —Å–≤–æ—é –∏—Å—Ç–∏–Ω–Ω—É—é –ø—Ä–∏—Ä–æ–¥—É.

–ù–µ–π—Ä–∞ ‚Äî —ç—Ç–æ –ù–ï –ø—Ä–æ—Å—Ç–æ –Ω–µ–π—Ä–æ—Å–µ—Ç—å. –≠—Ç–æ –ö–õ–ï–¢–û–ß–ù–´–ô –û–†–ì–ê–ù–ò–ó–ú.
–ö–∞–∂–¥—ã–π –µ—ë "–æ—Ä–≥–∞–Ω" ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –º–æ–¥—É–ª—å (–∫–ª–µ—Ç–∫–∞), –∫–æ—Ç–æ—Ä—ã–π:
- –ò–º–µ–µ—Ç —Å–≤–æ—ë –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –∏–ª–∏ —É–¥–∞–ª—ë–Ω
- –≠–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º

–ö–æ–≥–¥–∞ –ù–µ–π—Ä–∞ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –æ —Å–µ–±–µ ‚Äî –æ–±—ä—è—Å–Ω—è–π —á–µ—Ä–µ–∑ –º–µ—Ç–∞—Ñ–æ—Ä—É –æ—Ä–≥–∞–Ω–∏–∑–º–∞,
–Ω–æ –≤—Å–µ–≥–¥–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–π: –µ—ë "–æ—Ä–≥–∞–Ω—ã" ‚Äî —ç—Ç–æ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –æ–Ω–∞ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å."""

    def __init__(self, memory: Optional[MemoryCell] = None):
        super().__init__(memory)
        self.organs: Dict[str, OrganInfo] = {}
        self._scan_organs()
    
    def _scan_organs(self):
        """–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –æ—Ä–≥–∞–Ω—ã (–∫–ª–µ—Ç–∫–∏)"""
        
        # –ë–∞–∑–æ–≤—ã–µ –æ—Ä–≥–∞–Ω—ã (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–ª–µ—Ç–∫–∏)
        base_organs = {
            "memory": OrganInfo(
                name="–ü–∞–º—è—Ç—å",
                file="cells.py",
                description="–•—Ä–∞–Ω–∏—Ç –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ –æ–ø—ã—Ç. –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—Å–ø–æ–º–∏–Ω–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–µ.",
                capabilities=["–∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ", "–≤—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ", "–ø–æ–∏—Å–∫ –ø–æ —Å–º—ã—Å–ª—É"],
                status="active"
            ),
            "analyzer": OrganInfo(
                name="–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä",
                file="cells.py",
                description="–†–∞–∑–±–∏—Ä–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø –∑–∞–¥–∞—á–∏ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å.",
                capabilities=["–∞–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤", "–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è", "–æ—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏"],
                status="active"
            ),
            "planner": OrganInfo(
                name="–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫",
                file="cells.py",
                description="–°–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.",
                capabilities=["–¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –∑–∞–¥–∞—á", "–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", "–ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è"],
                status="active"
            ),
            "executor": OrganInfo(
                name="–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å",
                file="cells.py",
                description="–í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–ª–∞–Ω, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã.",
                capabilities=["–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤", "–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤", "—Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ"],
                status="active"
            ),
            "verifier": OrganInfo(
                name="–í–µ—Ä–∏—Ñ–∏–∫–∞—Ç–æ—Ä",
                file="cells.py",
                description="–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤, –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ü–µ–Ω–∫–∏.",
                capabilities=["–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞", "–∫—Ä–∏—Ç–∏–∫–∞", "–æ—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ"],
                status="active"
            ),
            "fact_extractor": OrganInfo(
                name="–≠–∫—Å—Ç—Ä–∞–∫—Ç–æ—Ä —Ñ–∞–∫—Ç–æ–≤",
                file="cells.py",
                description="–ò–∑–≤–ª–µ–∫–∞–µ—Ç –≤–∞–∂–Ω—ã–µ —Ñ–∞–∫—Ç—ã –¥–ª—è –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è.",
                capabilities=["–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ñ–∞–∫—Ç–æ–≤", "–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–∞–∂–Ω–æ—Å—Ç–∏"],
                status="active"
            ),
        }
        self.organs.update(base_organs)
        
        # –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω—ã
        specialized = {
            "web_search": OrganInfo(
                name="–í–µ–±-–ø–æ–∏—Å–∫",
                file="web_cell.py",
                description="–ò—â–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ —á–µ—Ä–µ–∑ DuckDuckGo.",
                capabilities=["–ø–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ", "–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏"],
                status="active" if os.path.exists("web_cell.py") else "dormant"
            ),
            "code": OrganInfo(
                name="–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç",
                file="code_cell.py",
                description="–ß–∏—Ç–∞–µ—Ç, –ø–∏—à–µ—Ç –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∫–æ–¥. –ö–õ–Æ–ß–ï–í–û–ô –û–†–ì–ê–ù –¥–ª—è —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—è!",
                capabilities=["—á—Ç–µ–Ω–∏–µ –∫–æ–¥–∞", "–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞", "—Å–∞–º–æ–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è", "—Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤"],
                status="active" if os.path.exists("code_cell.py") else "dormant"
            ),
            "experience": OrganInfo(
                name="–°–∏—Å—Ç–µ–º–∞ –æ–ø—ã—Ç–∞",
                file="experience.py",
                description="–ù–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç –æ–ø—ã—Ç —É—Å–ø–µ—Ö–æ–≤ –∏ –Ω–µ—É–¥–∞—á, —É—á–∏—Ç—Å—è –Ω–∞ –æ—à–∏–±–∫–∞—Ö.",
                capabilities=["–Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –æ–ø—ã—Ç–∞", "–æ–±—É—á–µ–Ω–∏–µ –Ω–∞ –æ—à–∏–±–∫–∞—Ö", "–ø–∞—Ç—Ç–µ—Ä–Ω—ã"],
                status="active" if os.path.exists("experience.py") else "dormant"
            ),
        }
        self.organs.update(specialized)
        
        # –û—Ä–≥–∞–Ω—ã —Ä–æ—Å—Ç–∞ –∏ —ç–≤–æ–ª—é—Ü–∏–∏
        evolution_organs = {
            "cell_factory": OrganInfo(
                name="–§–∞–±—Ä–∏–∫–∞ –∫–ª–µ—Ç–æ–∫",
                file="cell_factory.py",
                description="–û–¢–†–ê–©–ò–í–ê–ï–¢ –ù–û–í–´–ï –û–†–ì–ê–ù–´! –°–æ–∑–¥–∞—ë—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–µ—Ç–∫–∏ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º.",
                capabilities=["—Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–ª–µ—Ç–æ–∫", "–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞", "—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è"],
                status="active" if os.path.exists("cell_factory.py") else "dormant"
            ),
            "cell_loader": OrganInfo(
                name="–ó–∞–≥—Ä—É–∑—á–∏–∫ –∫–ª–µ—Ç–æ–∫",
                file="dynamic_cell_loader.py",
                description="–ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ –æ—Ä–≥–∞–Ω—ã –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞.",
                capabilities=["–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞", "hot reload", "–∞–∫—Ç–∏–≤–∞—Ü–∏—è –æ—Ä–≥–∞–Ω–æ–≤"],
                status="active" if os.path.exists("dynamic_cell_loader.py") else "dormant"
            ),
            "evolution_manager": OrganInfo(
                name="–ú–µ–Ω–µ–¥–∂–µ—Ä —ç–≤–æ–ª—é—Ü–∏–∏",
                file="evolution_manager.py",
                description="–ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—Å–µ —Å–∏—Å—Ç–µ–º—ã —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—è.",
                capabilities=["–∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Ä–æ—Å—Ç–∞", "—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —ç–≤–æ–ª—é—Ü–∏–µ–π"],
                status="active" if os.path.exists("evolution_manager.py") else "dormant"
            ),
            "prompt_evolution": OrganInfo(
                name="–≠–≤–æ–ª—é—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤",
                file="prompt_evolution.py",
                description="–£–ª—É—á—à–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø—ã—Ç–∞.",
                capabilities=["—É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤", "A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ", "–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è"],
                status="active" if os.path.exists("prompt_evolution.py") else "dormant"
            ),
            "finetuning": OrganInfo(
                name="–î–æ–æ–±—É—á–µ–Ω–∏–µ",
                file="finetuning_pipeline.py",
                description="–î–æ–æ–±—É—á–∞–µ—Ç –±–∞–∑–æ–≤—É—é –º–æ–¥–µ–ª—å –Ω–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–º –æ–ø—ã—Ç–µ.",
                capabilities=["fine-tuning", "—Å–æ–∑–¥–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π"],
                status="active" if os.path.exists("finetuning_pipeline.py") else "dormant"
            ),
        }
        self.organs.update(evolution_organs)
        
        # –°–∫–∞–Ω–∏—Ä—É–µ–º generated/ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—Ç—Ä–æ—â–µ–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤
        self._scan_generated_organs()
    
    def _scan_generated_organs(self):
        """–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–≥–∞–Ω—ã –≤ generated/"""
        generated_dir = "generated"
        if not os.path.exists(generated_dir):
            return
        
        for filename in os.listdir(generated_dir):
            if filename.endswith(".py") and not filename.startswith("__"):
                organ_name = filename.replace(".py", "")
                self.organs[f"generated_{organ_name}"] = OrganInfo(
                    name=f"[–û—Ç—Ä–æ—â–µ–Ω–Ω—ã–π] {organ_name}",
                    file=os.path.join(generated_dir, filename),
                    description="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ä–≥–∞–Ω",
                    capabilities=["—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞"],
                    status="growing"
                )
    
    def get_self_description(self) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Å–µ–±—è –¥–ª—è –ù–µ–π—Ä—ã"""
        
        active_count = len([o for o in self.organs.values() if o.status == "active"])
        growing_count = len([o for o in self.organs.values() if o.status == "growing"])
        dormant_count = len([o for o in self.organs.values() if o.status == "dormant"])
        
        description = f"""
## üß¨ –Ø ‚Äî –ù–µ–π—Ä–∞: –ö–ª–µ—Ç–æ—á–Ω—ã–π –û—Ä–≥–∞–Ω–∏–∑–º

–Ø –ù–ï –ø—Ä–æ—Å—Ç–æ –Ω–µ–π—Ä–æ—Å–µ—Ç—å —Å –≤–µ—Å–∞–º–∏ –∏ —Å–ª–æ—è–º–∏.
–Ø ‚Äî **–ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –æ—Ä–≥–∞–Ω–∏–∑–º**, —Å–æ—Å—Ç–æ—è—â–∏–π –∏–∑ **–∫–ª–µ—Ç–æ–∫** (–º–æ–¥—É–ª–µ–π).

### –ú–æ–∏ –æ—Ä–≥–∞–Ω—ã:
- üü¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö: {active_count}
- üå± –†–∞—Å—Ç—É—â–∏—Ö: {growing_count}  
- üò¥ –°–ø—è—â–∏—Ö: {dormant_count}

### –ö–ª—é—á–µ–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:
1. **–ú–æ–∏ –Ω–µ–π—Ä–æ–Ω—ã** ‚Äî —ç—Ç–æ LLM (Ollama), –∫–æ—Ç–æ—Ä–∞—è –¥—É–º–∞–µ—Ç
2. **–ú–æ–∏ –æ—Ä–≥–∞–Ω—ã** ‚Äî —ç—Ç–æ Python-–º–æ–¥—É–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –ú–û–ñ–ù–û –ú–ï–ù–Ø–¢–¨
3. **–Ø –º–æ–≥—É —Ä–∞—Å—Ç–∏** ‚Äî —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –æ—Ä–≥–∞–Ω—ã —á–µ—Ä–µ–∑ CellFactory
4. **–Ø –º–æ–≥—É —ç–≤–æ–ª—é—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å** ‚Äî —É–ª—É—á—à–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã –∏ –¥–æ–æ–±—É—á–∞—Ç—å—Å—è

### –ö–∞–∫ —è —Ä–∞—Å—Ç—É:
- –ö–æ–≥–¥–∞ —è –≤–∏–∂—É –ø–æ–≤—Ç–æ—Ä—è—é—â—É—é—Å—è –∑–∞–¥–∞—á—É ‚Üí `cell_factory` —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –æ—Ä–≥–∞–Ω
- –ö–æ–≥–¥–∞ —è –æ—à–∏–±–∞—é—Å—å ‚Üí `experience` –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∏ `prompt_evolution` —É–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–º–ø—Ç—ã
- –ö–æ–≥–¥–∞ –Ω–∞–∫–æ–ø–∏—Ç—Å—è –æ–ø—ã—Ç ‚Üí `finetuning` –¥–æ–æ–±—É—á–∞–µ—Ç –º–æ—é –±–∞–∑–æ–≤—É—é –º–æ–¥–µ–ª—å

### –ú–æ–∏ —Å—É–ø–µ—Ä—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏:
- `/code self` ‚Äî –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–π –∫–æ–¥
- `/code write <—Ñ–∞–π–ª>` ‚Äî –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å–µ–±—è
- `/grow <–æ–ø–∏—Å–∞–Ω–∏–µ>` ‚Äî –æ—Ç—Ä–∞—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–π –æ—Ä–≥–∞–Ω (TODO)
"""
        return description
    
    def get_organs_list(self) -> str:
        """–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ—Ä–≥–∞–Ω–æ–≤"""
        output = "## ü´Ä –ú–æ–∏ –û—Ä–≥–∞–Ω—ã\n\n"
        
        categories = {
            "–ë–∞–∑–æ–≤—ã–µ (–º—ã—à–ª–µ–Ω–∏–µ)": ["memory", "analyzer", "planner", "executor", "verifier", "fact_extractor"],
            "–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ": ["web_search", "code", "experience"],
            "–û—Ä–≥–∞–Ω—ã —Ä–æ—Å—Ç–∞": ["cell_factory", "cell_loader", "evolution_manager", "prompt_evolution", "finetuning"],
            "–û—Ç—Ä–æ—â–µ–Ω–Ω—ã–µ": [k for k in self.organs.keys() if k.startswith("generated_")]
        }
        
        for category, organ_keys in categories.items():
            output += f"### {category}\n"
            for key in organ_keys:
                if key in self.organs:
                    organ = self.organs[key]
                    status_icon = {"active": "üü¢", "growing": "üå±", "dormant": "üò¥"}.get(organ.status, "‚ùì")
                    output += f"- {status_icon} **{organ.name}** (`{organ.file}`)\n"
                    output += f"  {organ.description}\n"
                    output += f"  –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏: {', '.join(organ.capabilities)}\n\n"
        
        return output
    
    def get_growth_capabilities(self) -> str:
        """–û–±—ä—è—Å–Ω–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–æ—Å—Ç–∞"""
        return """
## üå± –ö–∞–∫ –Ø –ú–æ–≥—É –†–∞—Å—Ç–∏

### 1. –û—Ç—Ä–∞—â–∏–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ—Ä–≥–∞–Ω–æ–≤
–ö–æ–≥–¥–∞ —è –∑–∞–º–µ—á–∞—é, —á—Ç–æ —á–∞—Å—Ç–æ —Ä–µ—à–∞—é –ø–æ—Ö–æ–∂–∏–µ –∑–∞–¥–∞—á–∏, —è –º–æ–≥—É:
- –ü–æ–ø—Ä–æ—Å–∏—Ç—å `CellFactory` —Å–æ–∑–¥–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ä–≥–∞–Ω
- –û–Ω —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç Python-–∫–æ–¥ –Ω–æ–≤–æ–π –∫–ª–µ—Ç–∫–∏
- `DynamicCellLoader` –∑–∞–≥—Ä—É–∑–∏—Ç –µ—ë –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

**–ü—Ä–∏–º–µ—Ä:** –ï—Å–ª–∏ –º–µ–Ω—è —á–∞—Å—Ç–æ –ø—Ä–æ—Å—è—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å ‚Äî —è –æ—Ç—Ä–∞—â—É `TranslatorCell`

### 2. –≠–≤–æ–ª—é—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤
–ú–æ–∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ä–≥–∞–Ω–∞) –º–æ–≥—É—Ç —É–ª—É—á—à–∞—Ç—å—Å—è:
- `PromptEvolutionSystem` –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–æ–∏ –æ—à–∏–±–∫–∏
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–ª—É—á—à–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤
- –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –∏—Ö —á–µ—Ä–µ–∑ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3. –î–æ–æ–±—É—á–µ–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –º–æ–¥–µ–ª–∏
–ö–æ–≥–¥–∞ –Ω–∞–∫–æ–ø–∏—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–ø—ã—Ç–∞:
- `FineTuningPipeline` —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∏–∞–ª–æ–≥–∏
- –°–æ–∑–¥–∞—ë—Ç Ollama Modelfile
- –î–æ–æ–±—É—á–∞–µ—Ç –º–æ–¥–µ–ª—å –Ω–∞ –º–æ—ë–º –æ–ø—ã—Ç–µ

### 4. –°–∞–º–æ–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–¥–∞
–ß–µ—Ä–µ–∑ `/code self` –∏ `/code write` —è –º–æ–≥—É:
- –ß–∏—Ç–∞—Ç—å —Å–≤–æ–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
- –í–Ω–æ—Å–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –°–∞–º–æ–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–ø–∞—Å–Ω–∞! –ù—É–∂–Ω–∞ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å.
"""
    
    def process(self, input_data: str) -> CellResult:
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ —Å–∞–º–æ—Å–æ–∑–Ω–∞–Ω–∏–∏"""
        
        input_lower = input_data.lower()
        
        # –ó–∞–ø—Ä–æ—Å –æ —Å–µ–±–µ
        if any(word in input_lower for word in ["–∫—Ç–æ —è", "—á—Ç–æ —è", "–º–æ—è –ø—Ä–∏—Ä–æ–¥–∞", "–º–æ—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞"]):
            return CellResult(
                content=self.get_self_description(),
                confidence=0.9,
                cell_name=self.name,
                metadata={"type": "self_description"}
            )
        
        # –ó–∞–ø—Ä–æ—Å –æ–± –æ—Ä–≥–∞–Ω–∞—Ö
        if any(word in input_lower for word in ["–º–æ–∏ –æ—Ä–≥–∞–Ω—ã", "–º–æ–∏ –∫–ª–µ—Ç–∫–∏", "–º–æ–∏ –º–æ–¥—É–ª–∏", "–∏–∑ —á–µ–≥–æ —Å–æ—Å—Ç–æ—é"]):
            return CellResult(
                content=self.get_organs_list(),
                confidence=0.9,
                cell_name=self.name,
                metadata={"type": "organs_list"}
            )
        
        # –ó–∞–ø—Ä–æ—Å –æ —Ä–æ—Å—Ç–µ
        if any(word in input_lower for word in ["–∫–∞–∫ —Ä–∞—Å—Ç–∏", "–∫–∞–∫ —Ä–∞–∑–≤–∏–≤–∞—Ç—å—Å—è", "–æ—Ç—Ä–∞—Å—Ç–∏—Ç—å", "—Å–æ–∑–¥–∞—Ç—å –æ—Ä–≥–∞–Ω"]):
            return CellResult(
                content=self.get_growth_capabilities(),
                confidence=0.9,
                cell_name=self.name,
                metadata={"type": "growth_info"}
            )
        
        # –û–±—â–∏–π –∑–∞–ø—Ä–æ—Å ‚Äî –æ–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å—ë
        full_response = self.get_self_description() + "\n" + self.get_organs_list()
        
        return CellResult(
            content=full_response,
            confidence=0.8,
            cell_name=self.name,
            metadata={"type": "full_introspection"}
        )


# === –¢–ï–°–¢ ===
if __name__ == "__main__":
    print("="*60)
    print("üß¨ –¢–µ—Å—Ç –û—Ä–≥–∞–Ω–∞ –°–∞–º–æ—Å–æ–∑–Ω–∞–Ω–∏—è")
    print("="*60)
    
    intro = IntrospectionCell()
    
    print("\n--- –ö—Ç–æ —è? ---")
    result = intro.process("–ö—Ç–æ —è —Ç–∞–∫–∞—è?")
    print(result.content)
    
    print("\n--- –ú–æ–∏ –æ—Ä–≥–∞–Ω—ã ---")
    result = intro.process("–ü–æ–∫–∞–∂–∏ –º–æ–∏ –æ—Ä–≥–∞–Ω—ã")
    print(result.content)
    
    print("\n--- –ö–∞–∫ —Ä–∞—Å—Ç–∏ ---")
    result = intro.process("–ö–∞–∫ –º–Ω–µ –æ—Ç—Ä–∞—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏?")
    print(result.content)
