#!/bin/sh
# Pre-commit hook –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞: cp scripts/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º..."

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤–∞–ª–∏–¥–∞—Ç–æ—Ä –Ω–∞ staged —Ñ–∞–π–ª–∞—Ö
python scripts/validate_code.py --staged
RESULT=$?

if [ $RESULT -ne 0 ]; then
    echo ""
    echo "‚ùå –ö–æ–º–º–∏—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ –≤ –∫–æ–¥–µ."
    echo "   –ò—Å–ø—Ä–∞–≤—å –æ—à–∏–±–∫–∏ (‚ùå) –∏ –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞."
    echo "   –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (‚ö†Ô∏è) –º–æ–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å."
    echo ""
    exit 1
fi

# –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
if [ -f "tests/test_basic.py" ]; then
    echo ""
    echo "üß™ –ó–∞–ø—É—Å–∫ –±–∞–∑–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤..."
    python -m pytest tests/test_basic.py -x -q 2>/dev/null
    if [ $? -ne 0 ]; then
        echo ""
        echo "‚ùå –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏!"
        exit 1
    fi
fi

echo ""
echo "‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã!"
exit 0
