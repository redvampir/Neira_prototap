"""
üß¨ –û–±—É—á–µ–Ω–∏–µ –ù–µ–π—Ä—ã —Å–æ–∑–¥–∞–Ω–∏—é –æ—Ä–≥–∞–Ω–æ–≤

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ —Å–∏—Å—Ç–µ–º—É –æ–ø—ã—Ç–∞ –ù–µ–π—Ä—ã –∑–Ω–∞–Ω–∏—è –æ —Ç–æ–º,
–∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ –æ—Ä–≥–∞–Ω—ã (—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–µ—Ç–∫–∏).
"""

import json
import os
from datetime import datetime
from experience import ExperienceSystem

def train_organ_creation():
    """–û–±—É—á–∏—Ç—å –ù–µ–π—Ä—É —Å–æ–∑–¥–∞–Ω–∏—é –æ—Ä–≥–∞–Ω–æ–≤"""
    
    print("üß¨ –û–±—É—á–µ–Ω–∏–µ –ù–µ–π—Ä—ã —Å–æ–∑–¥–∞–Ω–∏—é –æ—Ä–≥–∞–Ω–æ–≤")
    print("=" * 60)
    
    exp = ExperienceSystem()
    
    # –£—Ä–æ–∫–∏ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –æ—Ä–≥–∞–Ω–æ–≤
    lessons = [
        # –£—Ä–æ–∫ 1: –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ä–≥–∞–Ω–∞
        {
            "task_type": "organ_creation",
            "user_input": "–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –æ—Ä–≥–∞–Ω?",
            "verdict": "–ü–†–ò–ù–Ø–¢",
            "score": 10,
            "problems": "",
            "lesson": """–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ä–≥–∞–Ω–∞ (–∫–ª–µ—Ç–∫–∏):
1. –§–∞–π–ª: –Ω–∞–∑–≤–∞–Ω–∏–µ_cell.py –≤ –ø–∞–ø–∫–µ generated/
2. –ö–ª–∞—Å—Å –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç Cell –∏–ª–∏ –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π
3. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: name, system_prompt
4. –ú–µ—Ç–æ–¥ process(input_data) - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
5. –í–æ–∑–≤—Ä–∞—Ç CellResult —Å content –∏ confidence"""
        },
        
        # –£—Ä–æ–∫ 2: –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –æ—Ä–≥–∞–Ω–∞
        {
            "task_type": "organ_creation",
            "user_input": "–ü–æ–∫–∞–∂–∏ –ø—Ä–∏–º–µ—Ä –æ—Ä–≥–∞–Ω–∞",
            "verdict": "–ü–†–ò–ù–Ø–¢",
            "score": 10,
            "problems": "",
            "lesson": '''–ü—Ä–∏–º–µ—Ä MathHelperCell:
```python
class MathHelperCell(Cell):
    name = "math_helper"
    system_prompt = "–¢—ã –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–º–æ—â–Ω–∏–∫. –†–µ—à–∞–π –∑–∞–¥–∞—á–∏ –ø–æ—à–∞–≥–æ–≤–æ."
    
    def process(self, input_data: str) -> CellResult:
        result = self.call_llm(input_data)
        return CellResult(content=result, confidence=0.8, cell_name=self.name)
```'''
        },
        
        # –£—Ä–æ–∫ 3: –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
        {
            "task_type": "organ_creation",
            "user_input": "–ö–∞–∫ –æ—Ä–≥–∞–Ω —É–∑–Ω–∞–µ—Ç –∫–æ–≥–¥–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å—Å—è?",
            "verdict": "–ü–†–ò–ù–Ø–¢",
            "score": 10,
            "problems": "",
            "lesson": """–¢—Ä–∏–≥–≥–µ—Ä—ã –æ—Ä–≥–∞–Ω–∞ - –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞/—Ñ—Ä–∞–∑—ã:
- –£–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ triggers: ["–ø–æ—Å—á–∏—Ç–∞–π", "–≤—ã—á–∏—Å–ª–∏", "–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞"]
- CellRouter –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å –∑–∞–ø—Ä–æ—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ß–µ–º –±–æ–ª—å—à–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ —Å–æ–≤–ø–∞–ª–æ - —Ç–µ–º –≤—ã—à–µ score
- –û—Ä–≥–∞–Ω —Å –≤—ã—Å—à–∏–º score –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è"""
        },
        
        # –£—Ä–æ–∫ 4: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
        {
            "task_type": "organ_creation",
            "user_input": "–ö–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ä–≥–∞–Ω–æ–≤?",
            "verdict": "–ü–†–ò–ù–Ø–¢",
            "score": 10,
            "problems": "",
            "lesson": """–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –æ—Ä–≥–∞–Ω–æ–≤ (OrganGuardian):
- –ó–ê–ü–†–ï–©–ï–ù–û: eval, exec, __import__, os.system
- –ó–ê–ü–†–ï–©–ï–ù–û: —Ä–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –ó–ê–ü–†–ï–©–ï–ù–û: —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –æ–¥–æ–±—Ä–µ–Ω–∏—è
- –ü–û–î–û–ó–†–ò–¢–ï–õ–¨–ù–û: import requests, import os
- –í—Å–µ –æ—Ä–≥–∞–Ω—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –ø–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π"""
        },
        
        # –£—Ä–æ–∫ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        {
            "task_type": "organ_creation",
            "user_input": "–ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–≥–∞–Ω?",
            "verdict": "–ü–†–ò–ù–Ø–¢",
            "score": 10,
            "problems": "",
            "lesson": """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∞ (smoke-test):
1. –°–æ–∑–¥–∞—ë—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è process() —Å —Ç–µ—Å—Ç–æ–≤—ã–º –≤–≤–æ–¥–æ–º
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á—Ç–æ –æ—Ç–≤–µ—Ç –Ω–µ –ø—É—Å—Ç–æ–π
4. –ï—Å–ª–∏ —Ç–µ—Å—Ç –ø—Ä–æ–≤–∞–ª–µ–Ω - –æ—Ä–≥–∞–Ω —É–¥–∞–ª—è–µ—Ç—Å—è
5. –ï—Å–ª–∏ –ø—Ä–æ–π–¥–µ–Ω - –æ—Ä–≥–∞–Ω –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è"""
        },
        
        # –£—Ä–æ–∫ 6: JSON —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è
        {
            "task_type": "organ_creation",
            "user_input": "–ö–∞–∫ –æ–ø–∏—Å–∞—Ç—å –æ—Ä–≥–∞–Ω –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏?",
            "verdict": "–ü–†–ò–ù–Ø–¢",
            "score": 10,
            "problems": "",
            "lesson": '''JSON —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ä–≥–∞–Ω–∞:
{
  "cell_name": "snake_case_–∏–º—è",
  "description": "–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –æ—Ä–≥–∞–Ω (1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)",
  "purpose": "–ó–∞—á–µ–º –Ω—É–∂–µ–Ω (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)",
  "system_prompt": "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è LLM"
}
–í–∞–∂–Ω–æ: —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–π JSON –±–µ–∑ markdown!'''
        },
        
        # –£—Ä–æ–∫ 7: –¢–∏–ø—ã –æ—Ä–≥–∞–Ω–æ–≤
        {
            "task_type": "organ_creation",
            "user_input": "–ö–∞–∫–∏–µ —Ç–∏–ø—ã –æ—Ä–≥–∞–Ω–æ–≤ –±—ã–≤–∞—é—Ç?",
            "verdict": "–ü–†–ò–ù–Ø–¢",
            "score": 10,
            "problems": "",
            "lesson": """–¢–∏–ø—ã –æ—Ä–≥–∞–Ω–æ–≤:
- ui_code: —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (HTML/JS)
- code: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Python –∫–æ–¥–∞
- analysis: –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–¥–∞
- web: –ø–æ–∏—Å–∫ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
- memory: —Ä–∞–±–æ—Ç–∞ —Å –ø–∞–º—è—Ç—å—é
- custom: –ª—é–±–∞—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è"""
        },
        
        # –£—Ä–æ–∫ 8: –ö–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–Ω–∏—è
        {
            "task_type": "organ_creation",
            "user_input": "–ö–∞–∫ –ø–æ–ø—Ä–æ—Å–∏—Ç—å —Å–æ–∑–¥–∞—Ç—å –æ—Ä–≥–∞–Ω?",
            "verdict": "–ü–†–ò–ù–Ø–¢",
            "score": 10,
            "problems": "",
            "lesson": """–ö–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–≥–∞–Ω–∞ –≤ Telegram:
#—Å–æ–∑–¥–∞–π_–æ—Ä–≥–∞–Ω <–æ–ø–∏—Å–∞–Ω–∏–µ>
–∏–ª–∏
#grow_organ <description>

–ü—Ä–∏–º–µ—Ä: #—Å–æ–∑–¥–∞–π_–æ—Ä–≥–∞–Ω –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ –∫–æ—Ç–æ—Ä—ã–π —Ä–µ—à–∞–µ—Ç —É—Ä–∞–≤–Ω–µ–Ω–∏—è"""
        },
        
        # –£—Ä–æ–∫ 9: –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª
        {
            "task_type": "organ_creation",
            "user_input": "–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ—Ä–≥–∞–Ω–∞?",
            "verdict": "–ü–†–ò–ù–Ø–¢",
            "score": 10,
            "problems": "",
            "lesson": """–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ—Ä–≥–∞–Ω–∞:
1. –°–û–ó–î–ê–ù–ò–ï: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ ‚Üí –∫–æ–¥ ‚Üí —Ñ–∞–π–ª
2. –ü–†–û–í–ï–†–ö–ê: OrganGuardian —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –Ω–∞ —É–≥—Ä–æ–∑—ã
3. –ö–ê–†–ê–ù–¢–ò–ù: –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ä–≥–∞–Ω—ã –∂–¥—É—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è
4. –ê–ö–¢–ò–í–ê–¶–ò–Ø: –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ—Ä–≥–∞–Ω—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º–∏
5. –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï: CellRouter –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
6. –û–¢–ö–õ–Æ–ß–ï–ù–ò–ï: –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ—Ä–≥–∞–Ω—ã –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å"""
        },
        
        # –£—Ä–æ–∫ 10: –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ—Ä–≥–∞–Ω–∞
        {
            "task_type": "organ_creation",
            "user_input": "–†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è",
            "verdict": "–ü–†–ò–ù–Ø–¢",
            "score": 10,
            "problems": "",
            "lesson": '''–°–æ–∑–¥–∞–Ω–∏–µ JokeCell:
1. –ó–∞–ø—Ä–æ—Å: #—Å–æ–∑–¥–∞–π_–æ—Ä–≥–∞–Ω —Ä–∞—Å—Å–∫–∞–∑—á–∏–∫ –∞–Ω–µ–∫–¥–æ—Ç–æ–≤
2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è:
   {"cell_name": "joke_teller", 
    "description": "–†–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç –∞–Ω–µ–∫–¥–æ—Ç—ã",
    "purpose": "–†–∞–∑–≤–ª–µ–∫–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —é–º–æ—Ä–æ–º",
    "system_prompt": "–¢—ã –≤–µ—Å—ë–ª—ã–π —Ä–∞—Å—Å–∫–∞–∑—á–∏–∫..."}
3. –°–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª joke_teller.py
4. –¢–µ—Å—Ç: process("—Ä–∞—Å—Å–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç") ‚Üí –∞–Ω–µ–∫–¥–æ—Ç
5. –û—Ä–≥–∞–Ω –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!'''
        },
    ]
    
    # –î–æ–±–∞–≤–ª—è–µ–º —É—Ä–æ–∫–∏ –≤ —Å–∏—Å—Ç–µ–º—É –æ–ø—ã—Ç–∞
    added = 0
    for lesson in lessons:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–≥–æ —É—Ä–æ–∫–∞
        exists = any(
            e.lesson == lesson["lesson"] 
            for e in exp.experiences
        )
        
        if not exists:
            exp.record_experience(
                task_type=lesson["task_type"],
                user_input=lesson["user_input"],
                verdict=lesson["verdict"],
                score=lesson["score"],
                problems=lesson["problems"]
            )
            # –û–±–Ω–æ–≤–ª—è–µ–º —É—Ä–æ–∫ –≤—Ä—É—á–Ω—É—é (record_experience –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–≤–æ–π)
            if exp.experiences:
                exp.experiences[-1].lesson = lesson["lesson"]
            added += 1
            print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —É—Ä–æ–∫: {lesson['user_input']}")
        else:
            print(f"‚è≠Ô∏è –£—Ä–æ–∫ —É–∂–µ –µ—Å—Ç—å: {lesson['user_input']}")
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º
    exp.save_experience()
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Å–∞–π—Ç—ã –≤ –ª–∏—á–Ω–æ—Å—Ç—å
    organ_insights = [
        "–Ø –º–æ–≥—É —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ –æ—Ä–≥–∞–Ω—ã –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Å–≤–æ–∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π",
        "–ö–∞–∂–¥—ã–π –æ—Ä–≥–∞–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º - –Ω–∏–∫–∞–∫–æ–≥–æ –æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–¥–∞",
        "–•–æ—Ä–æ—à–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è = —Ö–æ—Ä–æ—à–∏–π –æ—Ä–≥–∞–Ω",
        "–¢—Ä–∏–≥–≥–µ—Ä—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –∫–æ–≥–¥–∞ –æ—Ä–≥–∞–Ω –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è",
        "–ü–µ—Ä–µ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π –æ—Ä–≥–∞–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ",
    ]
    
    for insight in organ_insights:
        if insight not in exp.personality.get("insights", []):
            exp.personality.setdefault("insights", []).append(insight)
            print(f"üí° –î–æ–±–∞–≤–ª–µ–Ω –∏–Ω—Å–∞–π—Ç: {insight[:50]}...")
    
    exp.save_personality()
    
    print("\n" + "=" * 60)
    print(f"üéâ –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
    print(f"   –î–æ–±–∞–≤–ª–µ–Ω–æ —É—Ä–æ–∫–æ–≤: {added}")
    print(f"   –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –æ–ø—ã—Ç–∞: {len(exp.experiences)}")
    print(f"   –ò–Ω—Å–∞–π—Ç–æ–≤: {len(exp.personality.get('insights', []))}")
    print("=" * 60)
    
    return added

if __name__ == "__main__":
    train_organ_creation()
