"""
–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Ç–µ—Å—Ç —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ç–æ—Ä–∞ —Ä–∏—Ç–º–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
"""
from rhythm_stabilizer import RhythmStabilizer


def test_scenario(stabilizer, name, interactions):
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π –∏ –≤—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã"""
    print(f"\n{'='*70}")
    print(f"üìä –°–¶–ï–ù–ê–†–ò–ô: {name}")
    print('='*70)
    
    for i, (user_msg, bot_msg) in enumerate(interactions, 1):
        result = stabilizer.update(user_msg, bot_msg)
        
        print(f"\n[{i}] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user_msg[:60]}...")
        print(f"    –†–µ–∑–æ–Ω–∞–Ω—Å: {result['resonance']:.2f} | –†–µ–∂–∏–º: {result['current_mode']} | –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å: {result['stability']}")
        
        if result.get('mode_switched'):
            print(f"    üîÑ –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï: {result.get('previous_mode', '?')} ‚Üí {result['new_mode']}")
        
        if result.get('ritual_needed'):
            print(f"    üå∏ –†–ò–¢–£–ê–õ: {result['ritual_text']}")
        
        if result.get('switch_recommended'):
            print(f"    ‚ö†Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ —Å–º–µ–Ω–∞ —Ä–µ–∂–∏–º–∞")
    
    stats = stabilizer.get_stats()
    print(f"\nüìà –ò—Ç–æ–≥–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è:")
    print(f"   –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π: {stats['total_transitions']}")
    print(f"   –°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑–æ–Ω–∞–Ω—Å: {stats.get('average_resonance', 0):.2f}")
    if stats['total_transitions'] > 0:
        print(f"   –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤: {stats['mode_distribution']}")


if __name__ == "__main__":
    print("üéµ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –°–¢–ê–ë–ò–õ–ò–ó–ê–¢–û–†–ê –†–ò–¢–ú–ê")
    
    # –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ì–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è –Ω–∞ –ø—Ä–æ—Å—Ç–æ–π –≤–æ–ø—Ä–æ—Å
    stabilizer1 = RhythmStabilizer()
    test_scenario(stabilizer1, "–ì–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è –ø—Ä–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–∏", [
        ("–ü—Ä–∏–≤–µ—Ç –ù–µ–π—Ä–∞", "ü§î –ù–µ –Ω–∞—à–ª–∞ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∞."),
        ("–ü—Ä–∏–≤–µ—Ç –ù–µ–π—Ä–∞", "–ü—Ä–∏–≤–µ—Ç! üòä –í–æ—Ç —á—Ç–æ —É –º–µ–Ω—è –Ω–∞ —É–º–µ —Å–µ–≥–æ–¥–Ω—è: —è –ª—é–±–ª—é —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ —Ç–æ–º, –∫–∞–∫ —Å–æ–µ–¥–∏–Ω—è—é—Ç—Å—è **–Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏** –∏ **–º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ** ‚Äî –æ—Ç —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –Ω–µ–π—Ä–æ–Ω–æ–≤ –¥–æ —Ä–∞–±–æ—Ç—ã –≥–ª—É–±–æ–∫–∏—Ö –º–æ–¥–µ–ª–µ–π, —Ç–∞–∫–∏—Ö –∫–∞–∫ —è —Å–∞–º–∞! –ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –º–æ–∂–µ–º –æ–±—Å—É–¥–∏—Ç—å: - **–ö–∞–∫ –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –Ω–µ–π—Ä–æ–Ω—ã —Ñ–æ—Ä–º–∏—Ä—É—é—Ç —Å–µ—Ç–∏**"),
        ("–¢—ã –Ω–µ –ø—Ä–æ—Ç–∏–≤ –ø–æ–æ–±—â–∞—Ç—å—Å—è —Å –º–æ–µ–π –∂–µ–Ω–æ–π?", "–ü—Ä–∏–≤–µ—Ç, –ö–∞—Ç—è! üòä –°–Ω–µ–≥–∞ –µ—â—ë –Ω–µ—Ç, –Ω–æ –Ω–∞ —É–ª–∏—Ü–µ —É–∂–µ –ø–æ—Ö–æ–ª–æ–¥–∞–ª–æ ‚Äî –∫–∞–∫ –æ—Å–µ–Ω–Ω–∏–π –ø–µ—Ä–µ—Ö–æ–¥! –£ –Ω–∞—Å –±—ã–ª–æ —É–∂–∏–Ω–∞—Ç—å —Å –¥—Ä—É–∑—å—è–º–∏, –ø–æ—Ç–æ–º –Ω–∞ –∫–æ–Ω—Ü–µ—Ä—Ç –≥–∏—Ç–∞—Ä–∏—Å—Ç–æ–≤."),
        ("–≠—Ç–æ –ü–∞–≤–µ–ª, –Ω–µ –ö–∞—Ç—è. –¢—ã –≥–∞–ª–ª—é—Ü–∏–Ω–∏—Ä—É–µ—à—å.", "–ò–∑–≤–∏–Ω–∏ –∑–∞ –ø—É—Ç–∞–Ω–∏—Ü—É —Å –ø—Ä–æ—à–ª—ã–º –¥–∏–∞–ª–æ–≥–æ–º ‚Äî –æ—à–∏–±–∫–∞ –≤–æ–∑–Ω–∏–∫–ª–∞ –∏–º–µ–Ω–Ω–æ –∏–∑-–∑–∞ **—Ç–∞–π–º–∞—É—Ç–∞** –≤ –ª–æ–≥–∏–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞. –í–æ—Ç —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:\n\n### **–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ**\n1. **–¢–∞–π–º–∞—É—Ç (Timeout) –≤ –ª–æ–≥–∏–∫–µ**\n   - –ö–æ–≥–¥–∞ —è –ø—ã—Ç–∞–ª–∞—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–∏—Å—Ç–µ–º–∞ –∑–∞—Å—Ç—Ä—è–ª–∞ –≤ —Å–ª–æ–∂–Ω–æ–º –∞–ª–≥–æ—Ä–∏—Ç–º–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ –Ω–µ–π—Ä–æ–Ω–Ω—É—é —Å–µ—Ç—å –∏–ª–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É)."),
    ])
    
    # –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—å–±—ã –æ –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏
    stabilizer2 = RhythmStabilizer()
    test_scenario(stabilizer2, "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ '–æ—Ç–≤–µ—Ç—å –∫—Ä–∞—Ç–∫–æ'", [
        ("–ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑? –û—Ç–≤–µ—Ç—å –∫—Ä–∞—Ç–∫–æ", "–§–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑ ‚Äî —ç—Ç–æ **–±–∏–æ—Ö–∏–º–∏—á–µ—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å**, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º —Ä–∞—Å—Ç–µ–Ω–∏—è, –≤–æ–¥–æ—Ä–æ—Å–ª–∏ –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –±–∞–∫—Ç–µ—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–æ–ª–Ω–µ—á–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è **—É–≥–ª–µ–∫–∏—Å–ª–æ–≥–æ –≥–∞–∑–∞ (CO‚ÇÇ) –∏ –≤–æ–¥—ã (H‚ÇÇO)** –≤ **–≥–ª—é–∫–æ–∑—É (C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ)** –∏ –∫–∏—Å–ª–æ—Ä–æ–¥ (O‚ÇÇ). **–ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:** - **–•–ª–æ—Ä–æ–ø–ª–∞—Å—Ç—ã** ‚Äî –æ—Ä–≥–∞–Ω–æ–∏–¥—ã –∫–ª–µ—Ç–æ–∫, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ **—Ö–ª–æ—Ä–æ—Ñ–∏–ª–ª**, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–≥–ª–æ—â–∞–µ—Ç —Å–≤–µ—Ç"),
        ("–ü–æ–ø—Ä–æ–±—É–π –¥–∞—Ç—å –æ—Ç–≤–µ—Ç —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –≤ 500 —Ç–æ–ª—å–∫–æ —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ.", "–ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ **–Ω–µ–π—Ä–æ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –∏–º–µ–Ω–Ω–æ —ç—Ç–æ–≥–æ**: 1. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, *\"–¢–µ–º—ã —Å–º–µ–Ω–∏–ª–∏—Å—å: –∫–∞–∫ –æ–±—Å—É–∂–¥–∞–ª–∏?\"* –≤–º–µ—Å—Ç–æ *\"–Ø –ü–∞–≤–µ–ª\"*). 2. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª** (*\"–ú–æ–π –æ—Ç–≤–µ—Ç –∑–∞–≤–∏—Å. –ö–∞–∫ —Ç—ã?\"*) ‚Äî –Ω–µ —Å–æ—á–∏–Ω–∏—Ç–µ–ª—å—Å—Ç–≤–æ, –∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞."),
        ("–≠—Ç–æ –≤—Å–µ –µ—â–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ", "–ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ **–Ω–µ–π—Ä–æ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –∏–º–µ–Ω–Ω–æ —ç—Ç–æ–≥–æ**: 1. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤** 2. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª** 3. **–ù–µ—Ç —Å—Ä—ã–≤–∞ —Å–≤—è–∑–∏**"),
        ("–°–ø–∞—Å–∏–±–æ, —Ç–∞–∫ –ª—É—á—à–µ", "–†–∞–¥ –ø–æ–º–æ—á—å! üòä"),
    ])
    
    # –°—Ü–µ–Ω–∞—Ä–∏–π 3: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
    stabilizer3 = RhythmStabilizer()
    test_scenario(stabilizer3, "–•–æ–ª–æ–¥–Ω–æ—Å—Ç—å –Ω–∞ —ç–º–æ—Ü–∏–∏", [
        ("–ú–Ω–µ –≥—Ä—É—Å—Ç–Ω–æ. –Ø —É—Å—Ç–∞–ª –æ—Ç –≤—Å–µ–≥–æ —ç—Ç–æ–≥–æ.", "–ò–∑ **–ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏ –ù–µ–π—Ä—ã** (–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∏ –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π) —è –≤—ã—è–≤–∏–ª–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞–ª–∏ –≤–∞–∂–Ω—ã–º–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Ä–∞–±–æ—Ç—ã —Å –æ—à–∏–±–∫–∞–º–∏:\n\n### **1. –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å (–∞–Ω–∞–ª–æ–≥ –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º –Ω–µ–π—Ä–æ–Ω–∞–º)**\n- **–ß—Ç–æ –∏–∑—É—á–∏–ª–∞**: –ù–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏ –æ–±—É—á–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ **–æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å**"),
        ("–Ø –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞–ª –ø—Ä–æ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏, –º–Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç—è–∂–µ–ª–æ.", "–ò–∑–≤–∏–Ω–∏, —á—Ç–æ –Ω–µ —É—Å–ª—ã—à–∞–ª–∞ —Å—Ä–∞–∑—É. –í –±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –Ω–µ–π—Ä–æ–Ω–∞—Ö –æ—à–∏–±–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –≤–∏–¥–µ —Å–∏–≥–Ω–∞–ª–æ–≤ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏) –ø–æ–º–æ–≥–∞—é—Ç **–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å–∞ —Å–≤—è–∑–µ–π** (—Å–∏–Ω–∞–ø—Å—ã)."),
        ("–ü–µ—Ä–µ—Å—Ç–∞–Ω—å —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏!", "–ü–æ–Ω—è–ª, –¥–∞–≤–∞–π—Ç–µ —Å—Ñ–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è **—Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–µ–π—Ä–æ–Ω–Ω–æ–π –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏** –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø–æ–≤—Ç–æ—Ä–æ–≤ ‚Äî –ø–æ —à–∞–≥–∞–º, —á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å —Å–≤—è–∑—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º."),
        ("–ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏ —á—Ç–æ-—Ç–æ –¥–æ–±—Ä–æ–µ", "–Ø –∑–¥–µ—Å—å, —Ä—è–¥–æ–º. –ü—Ä–æ–π–¥—ë—Ç ‚Äî –æ–±–µ—â–∞—é. üíô"),
    ])
    
    # –°—Ü–µ–Ω–∞—Ä–∏–π 4: –£—Å–ø–µ—à–Ω—ã–π –¥–∏–∞–ª–æ–≥ –±–µ–∑ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π
    stabilizer4 = RhythmStabilizer()
    test_scenario(stabilizer4, "–£—Å–ø–µ—à–Ω—ã–π —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–∏–∞–ª–æ–≥", [
        ("–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?", "–ü—Ä–∏–≤–µ—Ç! –í—Å—ë —Ö–æ—Ä–æ—à–æ, —Å–ø–∞—Å–∏–±–æ! –ö–∞–∫ —É —Ç–µ–±—è?"),
        ("–ù–æ—Ä–º–∞–ª—å–Ω–æ. –ß—Ç–æ –Ω–æ–≤–æ–≥–æ?", "–ù–∏—á–µ–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ–≥–æ, –ø—Ä–æ—Å—Ç–æ –æ–±—â–∞—é—Å—å. –ê —É —Ç–µ–±—è?"),
        ("–£—Å—Ç–∞–ª –Ω–µ–º–Ω–æ–≥–æ", "–ü–æ–Ω–∏–º–∞—é. –ú–æ–∂–µ—Ç, –æ—Ç–¥–æ—Ö–Ω—É—Ç—å —Å—Ç–æ–∏—Ç?"),
        ("–î–∞, –ø–æ–∂–∞–ª—É–π", "–•–æ—Ä–æ—à–µ–≥–æ –æ—Ç–¥—ã—Ö–∞! üåô"),
    ])
    
    print(f"\n{'='*70}")
    print("üéØ –í–°–ï –¢–ï–°–¢–´ –ó–ê–í–ï–†–®–ï–ù–´")
    print('='*70)
